#!/usr/bin/env bash

set -eufo pipefail

export SWWW_TRANSITION_FPS=60
export SWWW_TRANSITION_STEP=2

usage() {
  echo "Usage: $(basename "$0") <path_to_wallpaper>"
  exit 1
}

error() {
  echo "ERROR: $1" >&2
  exit 1
}

info() {
  echo "INFO: $1"
}

test -z "${1:-}" && usage
wallpaper_path="$1"
test -f "$wallpaper_path" || error "Wallpaper file '${wallpaper_path}' does not exist"

info "Running matugen ..."
if ! matugen image "$wallpaper_path" \
  -t {{ .theme.settings.matugen.scheme }} \
  -m {{ .theme.settings.matugen.mode }} \
  -r {{ index .theme.settings.matugen "resize-filter" }} \
  --contrast {{ .theme.settings.matugen.contrast }}; then
  error "Failed to run matugen"
fi

info "Done."
